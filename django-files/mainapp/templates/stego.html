{% extends 'base.html' %}
{% load static %}

{% block title %}
Home
{% endblock %}
{% block head %}
<link rel="stylesheet" href="{% static 'css/tab.css' %}" />
<link rel="stylesheet" href="{% static 'css/imgupload.css' %}" />
<link rel="stylesheet" href="{% static 'css/prism.css' %}" />


{% endblock %}
{% block content %}
<!--Navbar Start-->
<nav class="navbar navbar-expand-lg fixed-top d navbar-fusionx normal-nav" style="background-color: #6C55A3;">
    <div class="container">
        <a class="navbar-brand logo" href="">
            <img src="{% static 'images/chat-icon.png' %}" height="30">
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <i class="fas fa-bars"></i>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav ml-auto navbar-center" id="mySidenav">
                <li class="nav-item ">
                    <a href="{% url 'index' %}" class="nav-link">Home</a>
                </li>
                <li class="nav-item active">
                    <a href="{% url 'stego' %}" class="nav-link">stego</a>
                </li>
                <li class="nav-item ">
                    <a href="{% url 'about' %}" class="nav-link">About</a>
                </li>



            </ul>
        </div>
    </div>
</nav>
<!-- Navbar End -->

<!-- Header Start -->
<section class=" align-items-center position-relative d-flex" id="top" style="margin-top: 120px;">
    <div class="container-fluid">

        <center>
            <h2 class="highlight header-colorize text-uppercase mb-3 text">Encode / Decoce</h2>
        </center>
        <!-- Nav tabs -->
        <div class="card">
            <div class="card-header">
                <ul class="nav nav-tabs justify-content-center" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active" data-toggle="tab" href="#encoder" role="tab">
                            <i class="fa fa-code"></i> Encoder
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#decoder" role="tab">
                            <i class="fa fa-image"></i> Decoder
                        </a>
                    </li>

                </ul>
            </div>
            <div class="card-body">
                <!-- Tab panes -->
                <div class="tab-content text-center">
                    <div class="tab-pane active" id="encoder" role="tabpanel">
                    <div class="row" >

                    <div class="col-lg-6" >
                        <form method="post"  id="code_form">
                            {% csrf_token %}
                        <div class="form-outline">
                            <textarea name="user_code" class="form-control" id="textAreaExample1"
                            placeholder='Example:
class Solution(object):
    def twoSum(self, nums, target):
        """
        :type nums: List[int]
        :type target: int
        :rtype: List[int]
        """
        watched = {}
        for i, value in enumerate(nums):
            rest = target - value

            if rest in watched:
                return [watched[rest],i]
            else:
                watched[value] = i
                            '
                            rows="20"></textarea>
                            <!-- <label class="form-label" for="textAreaExample">Code</label> -->
                           
                        </div>
                    </form>
                    </div>
                    
                    <div class="col-lg-6" style="height: 50vh;overflow-y: scroll;">
                        <div class="d-flex justify-content-center mt-5">
                            <a href="#" class="btn btn-primary m-2" id="downloadButton"><i class="fa fa-download"></i></a>
                            <a href="#" class="btn btn-success m-2" id="viewButton"><i class="fa fa-expand"></i></a>
                        </div>
                        <img id="encoded_img" class="img"  src="{% static 'images/encode-demo.png' %}">
                    </div>
                </div>
                </div>
                    <div class="tab-pane" id="decoder" role="tabpanel">
                        <!-- Upload Area -->
                        <div class="row">
                            
                        <div class="col-lg-5">

                        
                        <div id="uploadArea" class="upload-area ">
                            <!-- Header -->
                            <div class="upload-area__header">
                                <h1 class="upload-area__title">Upload your file</h1>
                                <p class="upload-area__paragraph">
                                    File should be an image
                                    <strong class="upload-area__tooltip">
                                        Like
                                        <span class="upload-area__tooltip-data"></span>
                                        <!-- Data Will be Comes From Js -->
                                    </strong>
                                </p>
                            </div>
                            <!-- End Header -->
                            <form method="post"  enctype="multipart/form-data" id="image_form">
                                {% csrf_token %}
                            <!-- Drop Zoon -->
                            <div id="dropZoon" class="upload-area__drop-zoon drop-zoon">
                                <span class="drop-zoon__icon">
                                    <i class='bx bxs-file-image'></i>
                                </span>
                                <p class="drop-zoon__paragraph">Drop your file here or Click to browse</p>
                                <span id="loadingText" class="drop-zoon__loading-text">Please Wait</span>
                                <img src="" alt="Preview Image" id="previewImage" class="drop-zoon__preview-image"
                                    draggable="false">
                                <input type="file" id="fileInput" name="code_image" class="drop-zoon__file-input" accept="image/*">
                            </div>
                            <!-- End Drop Zoon -->

                            <!-- File Details -->
                            <div id="fileDetails" class="upload-area__file-details file-details">
                                <h3 class="file-details__title">Uploaded Image</h3>

                                <div id="uploadedFile" class="uploaded-file">
                                    <div class="uploaded-file__icon-container">
                                        <i class='bx bxs-file-blank uploaded-file__icon'></i>
                                        <span class="uploaded-file__icon-text"></span>
                                        <!-- Data Will be Comes From Js -->
                                    </div>

                                    <div id="uploadedFileInfo" class="uploaded-file__info">
                                        <span class="uploaded-file__name">Proejct 1</span>
                                        <span class="uploaded-file__counter">0%</span>
                                    </div>
                                </div>
                            </div>
                            
                            </form>
                            <!-- End File Details -->
                        </div>
                        </div>
                        <div class="col-lg-6">
                            <div class=" d-flex justify-content-end">
                                <button id="copyCode" class="btn btn-primary" data-toggle="tooltip" data-placement="top" title="Copy Code"><i class="fa fa-copy"></i></button>
                            </div>
                            <pre><code class="language-python">
class Solution(object):
    def twoSum(self, nums, target):
        """
        :type nums: List[int]
        :type target: int
        :rtype: List[int]
        """
        watched = {}
        for i, value in enumerate(nums):
            rest = target - value

            if rest in watched:
                return [watched[rest],i]
            else:
                watched[value] = i</code></pre>
                        </div>
                        <!-- End Upload Area -->
                        </div>
                </div>

                </div>
            </div>
        </div>



    </div>
</section>
<!-- Header End -->

<!-- About Start -->
<section class="section bg-grey" id="about">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-6 col-md-8">
                <div class="text-center mb-5">
                    <h2 class="highlight header-colorize text-uppercase mb-3">About Us</h2>
                    <p class="text-sub size-14">For to come to the smallest detail, no one should practice any kind of work unless he derives some benefit from it.</p>
                </div>
            </div>
        </div>
        <div class="row align-items-center">
            <div class="col-lg-5">
                <img src="{% static 'images/header-about.png' %}" alt="" class="img-fluid mx-auto d-block">
            </div>
            <div class="col-lg-6 offset-lg-1">
                <div class="text-sub mt-5 mt-lg-0">
                    <h3 class="title font-weight-medium mb-4">A perfect bootstrap theme for all types of business.</h3>
                    <p class="mb-4 size-15">But in order that you may see whence all this error is born, the pleasure of those who accuse and the pain of those who praise, I will open the whole matter, and those very things which, as it were, from that discoverer of truth.
                    </p>
                    <p class="mb-4 size-15">For no one despises or hates or runs away from pleasure because it is pleasure, but because great pains result to those who do not know how to follow pleasure with reason.</p>
                    <a href="" class="learn-more size-15">Learn more <span class="ml-2 right-icon"><i
                                class="fas fa-arrow-right"></i></span></a>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- About End -->



<!-- Contact Start -->
<section class="section" id="contact">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-6 col-md-8">
                <div class="text-center mb-5">
                    <h2 class="highlight header-colorize text-uppercase mb-3">Contact</h2>
                    <p class="text-sub size-14">Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi
                        ut aliquip ex ea commodo consequat.</p>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-4">
                <div class="contact-info">
                    <h4 class="title mb-4">Get Connected</h4>
                    <p class="text-sub size-15">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod
                        tempor incididunt ut labore et dolore magna aliqua. </p>
                    <p class="text-sub size-15 mb-4"><i class="fas fa-phone"></i> 659-888-5495</p>
                    <p class="text-sub size-15 mb-4"><i class="fas fa-mobile-alt"></i> +1-689-888-5495</p>
                    <p class="text-sub size-15 mb-4"><i class="fas fa-envelope"></i> info@example.com</p>
                    <p class="text-sub size-15 mb-4"><i class="fas fa-map-marker-alt"></i> 200 Lexington Ave, New York,
                        NY 10016, USA</p>
                </div>
            </div>

            <div class="col-lg-7 offset-lg-1">
                <div class="custom-form mt-4 mt-lg-0">
                    <form>
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="form-group">
                                    <label for="email">Email:</label>
                                    <input type="email" class="form-control" id="email"
                                        placeholder="Enter Your Email.." />
                                </div>
                            </div>
                            <div class="col-lg-12">
                                <div class="form-group">
                                    <label for="subject">Subject:</label>
                                    <input type="text" class="form-control" id="subject"
                                        placeholder="Enter Your Subject.." />
                                </div>
                            </div>
                            <div class="col-lg-12">
                                <div class="form-group">
                                    <label for="message">Message:</label>
                                    <textarea name="message" id="message" rows="4" class="form-control"
                                        placeholder="Enter Your Message.."></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-12">
                                <button href="" class="btn btn-primary"><span class="mr-2 left-icon"><i
                                            class="fas fa-envelope"></i></span> Send Message</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- contact End -->

{% endblock %}

{% block script %}

<script src="{% static 'js/imgupload.js' %}"></script>
<script src="{% static 'js/prism.js' %}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.10/clipboard.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/components/prism-python.min.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Find the copy button and code element
        var copyButton = document.getElementById("copyCode");
        var codeElement = document.querySelector("code");

        // Click event handler for the copy button
        copyButton.addEventListener("click", function () {
            // Create a text area to temporarily hold the code content
            var textArea = document.createElement("textarea");
            textArea.value = codeElement.textContent;

            // Append the text area to the document
            document.body.appendChild(textArea);

            // Select the text in the text area
            textArea.select();

            // Copy the selected text to the clipboard
            document.execCommand("copy");

            // Remove the temporary text area
            document.body.removeChild(textArea);

            // Show a success message
            alert("Code copied to clipboard!");
        });
    });
</script>
<script>
    $(document).ready(function() {
        // Initialize Clipboard.js for copy functionality
        new ClipboardJS('#copyCode');

        // Event listener for file input change (when an image is selected)
        $("#fileInput").change(function() {
            var formData = new FormData($("#image_form")[0]);

            $.ajax({
                type: "POST",
                url: "{% url 'decode-api' %}", // Replace with your decode URL
                data: formData,
                contentType: false,
                processData: false,
                success: function(data) {
                    // Assuming the response contains a 'decoded' field with the code
                    var decodedCode = data.decoded;
                    console.log(decodedCode,'kdjfkdjfkdj')
                    $("#uploadedFileInfo .uploaded-file__name").text("Decoded Code");
                    $("#copyCode").attr("data-clipboard-text", decodedCode);
                    $("code.language-python").text(decodedCode);

                    // Re-run Prism.js highlighting after code update
                    Prism.highlightAll();

                },
                error: function(xhr, status, error) {
                    // Handle errors here
                    Swal.fire({
                    icon: 'error',
                    title: 'Invalid Image',
                    text: 'Please select a valid image file.',
                });
                }
            });
        });
    });
</script>
<script>
    $(document).ready(function () {
        $('[name="tabs"]').change(function () {
            $('.tab-content .tab-pane').removeClass('show active');
            $('#' + $(this).attr('id') + '-content').addClass('show active');
        });
    });
</script>
<script>
$(document).ready(function() {
    // Declare the variable to store encoded image data
    var encodedImageData = null;

    // Function to handle encoding when the textarea input changes
    function encodeOnChange() {
        var userCode = $("#textAreaExample1").val();

        // Check if the user code is empty or contains only whitespace
        if (!userCode || userCode.trim() === "") {
            // Clear the image when there's no code
            $("#encoded_img").attr("src", "{% static 'images/encode-demo.png' %}");
            encodedImageData = null; // Reset encodedImageData
            return;
        }

        // Make the AJAX request to encode the code
        $.ajax({
            type: "POST",
            url: "/api/encode/",  // Replace with your API endpoint URL
            data: { user_code: userCode, csrfmiddlewaretoken: '{{ csrf_token }}' },
            success: function(data) {
                // Assuming data is JSON and contains the 'image_base64' field
                var imageBase64 = data.image_base64;
                $("#encoded_img").attr("src", "data:image/png;base64," + imageBase64);

                // Store the image data for download and view
                encodedImageData = imageBase64;
            },
            error: function(xhr, status, error) {
                // Handle errors here
                console.error(xhr);
                encodedImageData = null; // Reset encodedImageData in case of an error
            }
        });
    }

    // Attach the encodeOnChange function to the input event of the textarea
    $("#textAreaExample1").on("input", encodeOnChange);

    // Initial encoding when the page loads
    encodeOnChange();

    // Event listener for the "Download" button
    $("#downloadButton").click(function() {
        if (encodedImageData) {
            var downloadLink = document.createElement("a");
            downloadLink.href = "data:image/png;base64," + encodedImageData;
            downloadLink.download = "encoded_image.png";
            downloadLink.style.display = "none";
            document.body.appendChild(downloadLink);
            downloadLink.click();
            document.body.removeChild(downloadLink);
        } else {
            // Handle case where there's no image data to download
            Swal.fire({
                icon: 'error',
                title: 'No Image Data',
                text: 'There is no image data to download.',
            });
        }
    });

    // Event listener for the "View" button
    $("#viewButton").click(function() {
        if (encodedImageData) {
            var newWindow = window.open("");
            newWindow.document.write('<img src="data:image/png;base64,' + encodedImageData + '" />');
        } else {
            // Handle case where there's no image data to view
            Swal.fire({
                icon: 'error',
                title: 'No Image Data',
                text: 'There is no image data to view.',
            });
        }
    });
});

</script>







{% endblock %}